<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Store</title>

    <link rel="stylesheet" href="style.css">
</head>

<body>

    <header>
        <h1>Game Store</h1>
        <div class="menu">
            <a id="login" href="login.html">LOGIN</a>
            <a id="cart" class="logged-in" href="cart.html">CART</a>
            <button id="logout" class="logged-in">Logout</button>
        </div>
    </header>

    <main>

        <div class="banner-container">
            <div class="banner">
                <h1>Red Dead Redemption II</h1>
                <!-- <p>Amidst the decline of the Wild West at the turn of the 19th century, outlaw 
                    Arthur Morgan and his gang struggle to cope with the loss of their way of life.</p> -->
                <p>R$ 20,99</p>
                <button id="btn-comprar" >COMPRE AGORA</button>
            </div>
        </div>
    
        <div id="content"></div>

    </main>

    


    <script type="text/javascript">

        isLogged = localStorage.getItem("isLogged");
        username = localStorage.getItem("username");

        var login = document.getElementById("login");
        var logout = document.getElementById("logout");
        var cart = document.getElementById("cart");

        window.onload = () => {
            if (isLogged == "true") {
                logout.classList.toggle("logged-in");
                cart.classList.toggle("logged-in");
            } else {
                logout.classList.toggle("logged-out");
                cart.classList.toggle("logged-out");
            }

            listAllGames();
        }

        if(isLogged == "true") {
            login.textContent = username;
            login.href = "#";
            logout.classList.toggle("logged-in");
            cart.classList.toggle("logged-in");
        }

        logout.addEventListener("click", () => {
            localStorage.setItem("isLogged", false);
            localStorage.setItem("username", null);
            username = null;
            isLogged = false;
            login.textContent = "LOGIN";
            login.href = "login.html";
            logout.classList.toggle("logged-out");
            cart.classList.toggle("logged-out");
        });





        // ...


        function listAllGames() {

            var url = "http://localhost:8080/api/games";

            var response = JSON.parse(Get(url));

            var content = "";

            var cont = 1;

            for (let obj of response) {

                content += `<div class="game"><img src="${obj.image_url}" alt="${obj.id}" /><p>${obj.name}</p><p>R$ ${obj.price}</p></div>`;

                if (cont % 5 == 0) {
                    content += "<br>"
                }

                cont++;

            }

            document.getElementById("content").innerHTML = content;

            document.getElementById("content").addEventListener('click', (e) => {
                e = e || window.event;
                var target = e.target || e.srcElement; 

                var game_id = target.alt;

                var game = JSON.parse(Get("http://localhost:8080/api/games/"+game_id));

                if(isLogged == "true") {

                    var user = JSON.parse(Get("http://localhost:8080/users/name/"+username));

                    user.gameListCart.push(game);

                    url = "http://localhost:8080/users/edit/"+user.user_id;
                    body = JSON.stringify(user);
                    var response = Put(url, body);
                    console.log(response);
                } else {
                    window.location = "login.html";
                }

            });

        }


        function Get(url){
            var httpreq = new XMLHttpRequest(); 
            httpreq.open("GET",url,false);
            httpreq.send(null);
            return httpreq.responseText;          
        }

        function Put(url, body){
            var httpreq = new XMLHttpRequest(); 
            httpreq.open("PUT",url,false);
            httpreq.setRequestHeader("Content-Type", "application/json;charset=utf-8")
            httpreq.send(body);
            return httpreq.responseText;          
        }

    </script>
    
</body>

</html>